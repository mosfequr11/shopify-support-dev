{%- style -%}
  {%- if section.settings.section_padding_top != blank -%}
      #shopify-section-{{section.id}} .countdown-timer{
          padding-top: {{ section.settings.section_padding_top }}px;
      }
    {%- endif -%}
    {%- if section.settings.section_padding_bottom != blank -%}
      #shopify-section-{{section.id}} .countdown-timer{
          padding-bottom: {{ section.settings.section_padding_top }}px;
      }
    {%- endif -%}
{%- endstyle -%}
{% for block in section.blocks %}
  {%- case block.type -%}
    {%- when 'timer' -%}
      <count-down>
        <div
          class="countdown-timer"
          data-year="{{ block.settings.select_year }}"
          data-month="{{ block.settings.select_month }}"
          data-day="{{ block.settings.select_day }}"
          data-hour="{{ block.settings.select_hour }}"
          data-min="{{ block.settings.select_min }}"
        >
          <div data-time-message="" class="timer-end-message">{{ block.settings.timer_end_message }}</div>

          <div data-timer-visibility="false" class="countdown-timer-inner show-border-true timer-text-size-large">
            <div class="timer-block">
              <p>Days</p>
              <h3 class="id-days"></h3>
            </div>
            <span>:</span>
            <div class="timer-block">
              <p>Hrs</p>
              <h3 class="id-hours"></h3>
            </div>
            <span>:</span>
            <div class="timer-block">
              <p>Min</p>
              <h3 class="id-minutes"></h3>
            </div>
            <span>:</span>
            <div class="timer-block">
              <p>Sec</p>
              <h3 class="id-seconds"></h3>
            </div>
          </div>
        </div>
      </count-down>
  {% endcase %}
{% endfor %}
{% schema %}
{
  "name": "Countdown timer",
  "tag": "section",
  "class": "countdown-area",
  "settings": [
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 150,
      "step": 5,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 50
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 150,
      "step": 5,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 50
    }
  ],
  "blocks": [
    {
      "name": "Timer",
      "type": "timer",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "select_year",
          "label": "Year",
          "options": [
            {
              "value": "2025",
              "label": "2025"
            },
            {
              "value": "2026",
              "label": "2026"
            },
            {
              "value": "2027",
              "label": "2027"
            }
          ],
          "default": "2025"
        },
        {
          "type": "select",
          "id": "select_month",
          "label": "Month",
          "options": [
            {
              "value": "0",
              "label": "January"
            },
            {
              "value": "1",
              "label": "February"
            },
            {
              "value": "2",
              "label": "March"
            },
            {
              "value": "3",
              "label": "April"
            },
            {
              "value": "4",
              "label": "May"
            },
            {
              "value": "5",
              "label": "June"
            },
            {
              "value": "6",
              "label": "july"
            },
            {
              "value": "7",
              "label": "August"
            },
            {
              "value": "8",
              "label": "Septermber"
            },
            {
              "value": "9",
              "label": "October"
            },
            {
              "value": "10",
              "label": "November"
            },
            {
              "value": "11",
              "label": "December"
            }
          ],
          "default": "0"
        },
        {
          "type": "select",
          "id": "select_day",
          "label": "Day",
          "options": [
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            },
            {
              "value": "4",
              "label": "4"
            },
            {
              "value": "5",
              "label": "5"
            },
            {
              "value": "6",
              "label": "6"
            },
            {
              "value": "7",
              "label": "7"
            },
            {
              "value": "8",
              "label": "8"
            },
            {
              "value": "9",
              "label": "9"
            },
            {
              "value": "10",
              "label": "10"
            },
            {
              "value": "11",
              "label": "11"
            },
            {
              "value": "12",
              "label": "12"
            },
            {
              "value": "13",
              "label": "13"
            },
            {
              "value": "14",
              "label": "14"
            },
            {
              "value": "15",
              "label": "15"
            },
            {
              "value": "16",
              "label": "16"
            },
            {
              "value": "17",
              "label": "17"
            },
            {
              "value": "18",
              "label": "18"
            },
            {
              "value": "19",
              "label": "19"
            },
            {
              "value": "20",
              "label": "20"
            },
            {
              "value": "21",
              "label": "21"
            },
            {
              "value": "22",
              "label": "22"
            },
            {
              "value": "23",
              "label": "23"
            },
            {
              "value": "24",
              "label": "24"
            },
            {
              "value": "25",
              "label": "25"
            },
            {
              "value": "26",
              "label": "26"
            },
            {
              "value": "27",
              "label": "27"
            },
            {
              "value": "28",
              "label": "28"
            },
            {
              "value": "29",
              "label": "29"
            },
            {
              "value": "30",
              "label": "30"
            },
            {
              "value": "31",
              "label": "31"
            }
          ],
          "default": "1"
        },
        {
          "type": "select",
          "id": "select_hour",
          "label": "Hour",
          "options": [
            {
              "label": "01 AM",
              "value": "01"
            },
            {
              "label": "02 AM",
              "value": "02"
            },
            {
              "label": "03 AM",
              "value": "03"
            },
            {
              "label": "04 AM",
              "value": "04"
            },
            {
              "label": "05 AM",
              "value": "05"
            },
            {
              "label": "06 AM",
              "value": "06"
            },
            {
              "label": "07 AM",
              "value": "07"
            },
            {
              "label": "08 AM",
              "value": "08"
            },
            {
              "label": "09 AM",
              "value": "09"
            },
            {
              "label": "10 AM",
              "value": "10"
            },
            {
              "label": "11 AM",
              "value": "11"
            },
            {
              "label": "12 PM",
              "value": "12"
            },
            {
              "label": "1 PM",
              "value": "13"
            },
            {
              "label": "2 PM",
              "value": "14"
            },
            {
              "label": "3 PM",
              "value": "15"
            },
            {
              "label": "4 PM",
              "value": "16"
            },
            {
              "label": "5 PM",
              "value": "17"
            },
            {
              "label": "6 PM",
              "value": "18"
            },
            {
              "label": "7 PM",
              "value": "19"
            },
            {
              "label": "8 PM",
              "value": "20"
            },
            {
              "label": "9 PM",
              "value": "21"
            },
            {
              "label": "10 PM",
              "value": "22"
            },
            {
              "label": "11 PM",
              "value": "23"
            },
            {
              "label": "12 AM",
              "value": "24"
            }
          ],
          "default": "01"
        },
        {
          "type": "select",
          "id": "select_min",
          "label": "Minute",
          "options": [
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            },
            {
              "value": "4",
              "label": "4"
            },
            {
              "value": "5",
              "label": "5"
            },
            {
              "value": "6",
              "label": "6"
            },
            {
              "value": "7",
              "label": "7"
            },
            {
              "value": "8",
              "label": "8"
            },
            {
              "value": "9",
              "label": "9"
            },
            {
              "value": "10",
              "label": "10"
            },
            {
              "value": "11",
              "label": "11"
            },
            {
              "value": "12",
              "label": "12"
            },
            {
              "value": "13",
              "label": "13"
            },
            {
              "value": "14",
              "label": "14"
            },
            {
              "value": "15",
              "label": "15"
            },
            {
              "value": "16",
              "label": "16"
            },
            {
              "value": "17",
              "label": "17"
            },
            {
              "value": "18",
              "label": "18"
            },
            {
              "value": "19",
              "label": "19"
            },
            {
              "value": "20",
              "label": "20"
            },
            {
              "value": "21",
              "label": "21"
            },
            {
              "value": "22",
              "label": "22"
            },
            {
              "value": "23",
              "label": "23"
            },
            {
              "value": "24",
              "label": "24"
            },
            {
              "value": "25",
              "label": "25"
            },
            {
              "value": "26",
              "label": "26"
            },
            {
              "value": "27",
              "label": "27"
            },
            {
              "value": "28",
              "label": "28"
            },
            {
              "value": "29",
              "label": "29"
            },
            {
              "value": "30",
              "label": "30"
            },
            {
              "value": "31",
              "label": "31"
            },
            {
              "value": "32",
              "label": "32"
            },
            {
              "value": "33",
              "label": "33"
            },
            {
              "value": "34",
              "label": "34"
            },
            {
              "value": "35",
              "label": "35"
            },
            {
              "value": "36",
              "label": "36"
            },
            {
              "value": "37",
              "label": "37"
            },
            {
              "value": "38",
              "label": "38"
            },
            {
              "value": "39",
              "label": "39"
            },
            {
              "value": "40",
              "label": "40"
            },
            {
              "value": "41",
              "label": "41"
            },
            {
              "value": "42",
              "label": "42"
            },
            {
              "value": "43",
              "label": "43"
            },
            {
              "value": "44",
              "label": "44"
            },
            {
              "value": "45",
              "label": "45"
            },
            {
              "value": "46",
              "label": "46"
            },
            {
              "value": "47",
              "label": "47"
            },
            {
              "value": "48",
              "label": "48"
            },
            {
              "value": "49",
              "label": "49"
            },
            {
              "value": "50",
              "label": "50"
            },
            {
              "value": "51",
              "label": "51"
            },
            {
              "value": "52",
              "label": "52"
            },
            {
              "value": "53",
              "label": "53"
            },
            {
              "value": "54",
              "label": "54"
            },
            {
              "value": "55",
              "label": "55"
            },
            {
              "value": "56",
              "label": "56"
            },
            {
              "value": "57",
              "label": "57"
            },
            {
              "value": "58",
              "label": "58"
            },
            {
              "value": "59",
              "label": "59"
            },
            {
              "value": "60",
              "label": "60"
            }
          ],
          "default": "1"
        },
        {
          "type": "inline_richtext",
          "id": "timer_end_message",
          "label": "End message"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Countdown timer",
      "blocks": [
        {
          "type": "timer"
        }
      ]
    }
  ]
}
{% endschema %}
{% javascript %}
  class CountDown extends HTMLElement {
    constructor() {
      super();
      this.countdownVisibility = true;
      this.countdownTimer = this.querySelector('.countdown-timer');
      this.timerInner = this.querySelector('.countdown-timer-inner');
      this.timerVisibility = this.timerInner.dataset.timerVisibility;

      this.countdownSection = this.querySelector('.cd-timer-counter');

      this.message = this.querySelector('.timer-end-message');

      this.days = this.querySelector('.id-days');
      this.hours = this.querySelector('.id-hours');
      this.minutes = this.querySelector('.id-minutes');
      this.seconds = this.querySelector('.id-seconds');

      this.init();
    }
    init() {
      this.startTimer();
    }
    startTimer() {
      const { day, hour, min, month, year } = this.countdownTimer.dataset;
      const timerTime = new Date(year, month, day, hour, min, 0).getTime();
      const timerInterval = setInterval(() => {
        const now = new Date().getTime();
        const distance = timerTime - now;
        if (distance < 0) {
          clearInterval(timerInterval);
          this.message?.classList.add('active');
          // this.timerInner.classList.add("d-none")
          // this.timerVisibility === true ? this.timerInner.classList.add("inActive") : ''
          return;
        }
        this.timeTime(distance);
      }, 1000);
    }
    timeTime(distance) {
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      this.days.textContent = days;
      this.hours.textContent = ('0' + hours).slice(-2);
      this.minutes.textContent = ('0' + minutes).slice(-2);
      this.seconds.textContent = ('0' + seconds).slice(-2);
      this.timerInner.classList.add('active');
    }
  }
  customElements.define('count-down', CountDown);
{% endjavascript %}
